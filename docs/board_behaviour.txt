Wamble Board Behavior
======================

Overview
Manages a dynamic pool of game boards, assigning them to players based on an attractiveness score. Board lifecycle is handled by a state machine where `RESERVED`, `ACTIVE`, and `DORMANT` states count toward the configured board limit.
The manager maintains a target number of boards `max-boards`, computed from `longest_game_moves * active_players` with a floor of `min-boards`, and will create new boards when the pool drops below this target.

Board States
- `RESERVED`: A board temporarily assigned to a player who is actively playing. This state prevents other players from being assigned to the board.
- `ACTIVE`: A board that is currently in-play and held in the server's cache for quick access. Players can be assigned to active games.
- `DORMANT`: A board that is available for play but is not currently in the cache, residing only in the database. Players can be assigned to dormant games.
- `ARCHIVED`: A board representing a completed or illegal game, kept for historical and analytical purposes.

Board Lifecycle and State Transitions
- A game is `RESERVED` until a move is made or until `reservation-timeout` expires.
- A reservation is initially for the current session. If that session times out, the reservation is persisted to the database if and only if the user has a public key (i.e., a persistent identity).
- If a game remains reserved in the database for the full duration of the timeout, it is released as `DORMANT`.
- When a board is completed, pot scoring is distributed, the game is removed from cache, ratings should be updated (currently a placeholder), and released as `ARCHIVED`.
- An `ACTIVE` board is removed from the cache and becomes `DORMANT` after `inactivity-timeout` elapses to ensure the cache holds recently played games.

Board Assignment
- Aims to match players with appropriate and interesting game situations.
- Applies to both `DORMANT` and `ACTIVE` boards.
- An attractiveness score is calculated for each eligible board based on:
  - Game Phase: `early-game`, `mid-game`, `late-game`. Determined by move count.
  - Player Experience: New vs. experienced players, based on `NEW_PLAYER_GAMES_THRESHOLD`.
  - Recency: Time since the board was last assigned.
- Configuration multipliers are used to weigh the score:
  - `new-player-early-phase-mult`
  - `new-player-mid-phase-mult`
  - `new-player-end-phase-mult`
  - `experienced-player-early-phase-mult`
  - `experienced-player-mid-phase-mult`
  - `experienced-player-end-phase-mult`
- If no suitable board is found, a new one may be created if the pool is smaller than `max-boards`.

References
- Config (see docs/configuration.txt): `max-boards`, `min-boards`, `reservation-timeout`, `inactivity-timeout`, `new-player-early-phase-mult`, `new-player-mid-phase-mult`, `new-player-end-phase-mult`, `experienced-player-early-phase-mult`, `experienced-player-mid-phase-mult`, `experienced-player-end-phase-mult`.
